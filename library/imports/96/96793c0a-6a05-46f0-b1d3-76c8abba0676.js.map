{"version":3,"sources":["../../../../../assets/scripts/scene/assets/scripts/scene/GameScene.js"],"names":["SHAKE","cc","Class","extends","Component","properties","panel","Node","cellPF","Prefab","scoreLabel","Label","score","default","type","Integer","notify","string","init","params","loadCell","start","node","on","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","systemEvent","SystemEvent","KEY_DOWN","onKeyDown","board","num","moved","destroyAllChildren","i","rows","j","cell","instantiate","getComponent","x","y","parent","push","randomCell","getPanelPos","row","col","v2","event","startPos","getStartLocation","cur","getLocation","diff","subSelf","Math","abs","moveRight","moveLeft","moveUp","moveDown","keyCode","macro","KEY","up","down","left","right","round","random","log","canMoveUp","canMoveDown","canMoveLeft","canMoveRight","tmp","k","noBlockVertical","noBlockHorizonal","col1","col2","row1","row2"],"mappings":"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","file":"GameScene.js","sourceRoot":"../../../../../assets/scripts/scene","sourcesContent":["/**\n * Created by xujiawei on 2020-04-29 17:37:50\n */\n\nconst SHAKE = 10;  // 滑动阀值\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        panel: cc.Node,\n        cellPF: cc.Prefab,\n        scoreLabel: cc.Label,\n        score: {\n            default: 0,\n            type: cc.Integer,\n            notify(){\n                this.scoreLabel.string = this.score;\n            }\n        }\n    },\n\n    init(params) {\n        this.loadCell();\n    },\n\n    start() {\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        this.board[0][3].num = 2;\n        this.board[0][2].num = 2;\n        this.board[0][1].num = 4;\n        this.board[0][0].num = 4;\n    },\n\n    loadCell() {\n        this.moved = false;\n        this.score = 0;\n        this.panel.destroyAllChildren();\n        this.board = [];\n        for (let i = 0; i < 4; i++) {\n            let rows = [];\n            for (let j = 0; j < 4; j++) {\n                let cell = cc.instantiate(this.cellPF);\n                cell.getComponent(\"Cell\").num = 0;\n                cell.x = -270 + j * 180;\n                cell.y = 270 - i * 180;\n                cell.parent = this.panel;\n                rows.push(cell.getComponent(\"Cell\"));\n            }\n            this.board.push(rows);\n        }\n\n        this.randomCell();\n        this.randomCell();\n    },\n\n    getPanelPos(row, col) {\n        return cc.v2(-270 + col * 180, 270 - row * 180);\n    },\n\n    onTouchMove(event) {\n        if (this.moved) {\n            return;\n        }\n        // let pre = event.getPreviousLocation();\n        let startPos = event.getStartLocation();\n        let cur = event.getLocation();\n        let diff = cur.subSelf(startPos);\n        if (Math.abs(diff.x) > Math.abs(diff.y)) {\n            if (Math.abs(diff.x) < SHAKE) {\n                return;\n            }\n            this.moved = true;\n            if (diff.x > 0) {\n                this.moveRight();\n            } else {\n                this.moveLeft();\n            }\n        } else {\n            if (Math.abs(diff.y) < SHAKE) {\n                return;\n            }\n            this.moved = true;\n            if (diff.y > 0) {\n                this.moveUp();\n            } else {\n                this.moveDown();\n            }\n        }\n    },\n\n    onTouchEnd(event) {\n        this.moved = false;\n    },\n\n    onKeyDown(event) {\n        switch(event.keyCode) {\n            case cc.macro.KEY.up: \n                this.moveUp();\n                break;\n            case cc.macro.KEY.down:\n                this.moveDown();\n                break;\n            case cc.macro.KEY.left:\n                this.moveLeft();\n                break;\n            case cc.macro.KEY.right:\n                this.moveRight();\n                break;\n            default:\n                break;\n        }\n    },\n\n    randomCell() {\n        let i = Math.round(Math.random() * 3);\n        let j = Math.round(Math.random() * 3);\n        while (this.board[i][j].num != 0) {\n            i = Math.round(Math.random() * 3);\n            j = Math.round(Math.random() * 3);\n        }\n\n        cc.log(\"rpos:\", i, j);\n        this.board[i][j].num = 2;\n    },\n\n    canMoveUp() {\n        for (let col = 0; col <= 3; col++) {\n            for (let row = 1; row <= 3; row++) {\n                if (this.board[row][col].num != 0) {\n                    if (this.board[row - 1][col].num == 0 || this.board[row - 1][col].num == this.board[row][col].num) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    },\n\n    canMoveDown() {\n        for (let col = 0; col <= 3; col++) {\n            for (let row = 2; row >= 0; row--) {\n                if (this.board[row][col].num != 0) {\n                    if (this.board[row + 1][col].num == 0 || this.board[row + 1][col].num == this.board[row][col].num) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    },\n\n    canMoveLeft() {\n        for (let row = 3; row >= 0; row--) {\n            for (let col = 1; col <= 3; col++) {\n                if (this.board[row][col].num != 0) {\n                    if (this.board[row][col - 1].num == 0 || this.board[row][col - 1].num == this.board[row][col].num) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    },\n\n    canMoveRight() {\n        for (let row = 3; row >= 0; row--) {\n            for (let col = 2; col >= 0; col--) {\n                if (this.board[row][col].num != 0) {\n                    if (this.board[row][col + 1].num == 0 || this.board[row][col + 1].num == this.board[row][col].num) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    },\n\n    moveUp() {\n        cc.log('上滑动');\n        if (!this.canMoveUp()) {\n            return;\n        }\n\n        for (let col=0; col<=3; col++) {\n            let tmp = 0;\n            for (let row=0; row<=3; row++) {\n                if (this.board[row][col].num == 0) {\n                    continue;\n                }\n                for (let k=0+tmp; k<row; k++) {\n                    if (this.board[k][col].num == 0 && this.noBlockVertical(col, k, row)) {\n                        this.board[k][col].num = this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                        break;\n                    } else if (this.board[k][col].num == this.board[row][col].num && this.noBlockVertical(col, k, row)) {\n                        this.score += this.board[row][col].num * 2;\n                        this.board[k][col].num += this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                        tmp ++;\n                    }\n                }\n            }\n        }\n        this.randomCell();\n    },\n\n    moveDown() {\n        cc.log(\"下滑动\");\n        if (!this.canMoveDown()) {\n            return;\n        }\n\n        for (let col=0; col<=3; col++) {\n            let tmp = 0;\n            for (let row=3; row>=0; row--) {\n                if (this.board[row][col].num == 0) {\n                    continue;\n                }\n                for (let k=3-tmp; k>row; k--) {\n                    if (this.board[k][col].num == 0 && this.noBlockVertical(col, row, k)) {\n                        this.board[k][col].num = this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                    } else if (this.board[k][col].num == this.board[row][col].num && this.noBlockVertical(col, row, k)) {\n                        this.score += this.board[row][col].num * 2;\n                        this.board[k][col].num += this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                        tmp ++;\n                    }\n                }\n            }\n        }\n        this.randomCell();\n    },\n\n    moveLeft() {\n        cc.log(\"左滑动\");\n        if (!this.canMoveLeft()) {\n            return;\n        }\n\n        for (let row=3; row>=0; row--) {\n            let tmp = 0;\n            for (let col=0; col<=3; col++) {\n                if (this.board[row][col].num == 0) {\n                    continue;\n                }\n                for (let k=0+tmp; k<col; k++) {\n                    if (this.board[row][k].num == 0 && this.noBlockHorizonal(row, k, col)) {\n                        this.board[row][k].num = this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                    } else if (this.board[row][k].num == this.board[row][col].num && this.noBlockHorizonal(row, col, k)) {\n                        this.score += this.board[row][col].num * 2;\n                        this.board[row][k].num += this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                        tmp ++;\n                    }\n                }\n            }\n        }\n        this.randomCell();\n    },\n\n    moveRight() {\n        cc.log('右滑动');\n        if (!this.canMoveRight()) {\n            return;\n        }\n\n        for (let row=3; row>=0; row--) {\n            let tmp = 0;\n            for (let col=3; col>=0; col--) {\n                if (this.board[row][col].num == 0) {\n                    continue;\n                }\n                for (let k=3-tmp; k>col; k--) {\n                    if (this.board[row][k].num == 0 && this.noBlockHorizonal(row, col, k)) {\n                        this.board[row][k].num = this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                    } else if (this.board[row][k].num == this.board[row][col].num && this.noBlockHorizonal(row, col, k)) {\n                        this.score += this.board[row][col].num * 2;\n                        this.board[row][k].num += this.board[row][col].num;\n                        this.board[row][col].num = 0;\n                        tmp ++;\n                    }\n                }\n            }\n        }\n        this.randomCell();\n    },\n\n    noBlockHorizonal(row, col1, col2) {\n        for(let i=col1+1; i<col2; i++) {\n            if (this.board[row][i].num != 0) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    noBlockVertical(col, row1, row2) {\n        for(let i=row1+1; i<row2; i++) {\n            if (this.board[i][col].num != 0) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n});"]}